{% extends "base.html" %}
{% load staticfiles %}

{% block headers %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
<!-- <link rel="stylesheet" href="{% static 'highlight/styles/default.css' %}"> -->
{% endblock headers %}

{% block content %}

<!-- Main jumbotron for a primary marketing message or call to action -->
<div style="text-align:center">
  <div class="jumbotron">
    <div class="container">
      <h1>PVLIB API</h1>
      <p class="lead">Software for simulating photovoltaic solar energy systems.</p>
    </div><!-- /.container -->
  </div>
</div>

<div class="container">
  <h1 class="page-header">Solar Position</h1>
  <p>
    The first step to modeling a PV system is to get the solar position for the
    site. Use the PVLIB API by sending a <code>GET</code> request to
    <code>/api/v1/pvlib/solarposition/</code>, the response is <code>JSON</code>.
    The calculation requires the following parameters:
  </p>
  <ul>
    <li><code>lat</code> - latitude in degrees</li>
    <li><code>lon</code> - longitude in degrees</li>
    <li><code>start</code> - start date/time</li>
    <li><code>end</code> - end date/time</li>
    <li><code>freq</code> - (optional) frequency as pandas offset alias [default hourly, <code>H</code>]</li>
    <li><code>tz</code> - (optional) timezone in hours [default zero]</li>
  </ul>
  <p>
    <i>Note: the API uses <a href="https://pandas.pydata.org/pandas-docs/stable/index.html">pandas</a>
    to parse dates and times, see the documentation for formats.</i>
  </p>
  <h2>Example</h2>
  <p>
    Try the following:
    <a href="/api/v1/pvlib/solarposition/?lat=38&lon=-122&start=2018-01-01 7:00&end=2018-01-01 8:00&freq=T&tz=-8" target="_blank">
    <code>/api/v1/pvlib/solarposition/?lat=38&lon=-122&start=2018-01-01 7:00&end=2018-01-01 8:00&freq=T&tz=-8</code></a>
  </p>
  <br/>
  <form id="solposform">
    <div class="row">
      <div class="col-md-2">
        <div class="form-group">
        {{ forms.solposform.lat.errors }}
        {{ forms.solposform.lat.label_tag }}
        {{ forms.solposform.lat }}
        </div>
      </div>
      <div class="col-md-2">
        <div class="form-group">
        {{ forms.solposform.lon.errors }}
        {{ forms.solposform.lon.label_tag }}
        {{ forms.solposform.lon }}
        </div>
      </div>
      <div class="col-md-2">
        <div class="form-group">
        {{ forms.solposform.start.errors }}
        {{ forms.solposform.start.label_tag }}
        {{ forms.solposform.start }}
        </div>
      </div>
      <div class="col-md-2">
        <div class="form-group">
        {{ forms.solposform.end.errors }}
        {{ forms.solposform.end.label_tag }}
        {{ forms.solposform.end }}
        </div>
      </div>
      <div class="col-md-2">
        <div class="form-group">
        {{ forms.solposform.freq.errors }}
        {{ forms.solposform.freq.label_tag }}
        {{ forms.solposform.freq }}
        </div>
      </div>
      <div class="col-md-2">
        <div class="form-group">
        {{ forms.solposform.tz.errors }}
        {{ forms.solposform.tz.label_tag }}
        {{ forms.solposform.tz }}
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-2">
        <button id="solposbutton" class="btn btn-primary">Submit</button>
      </div>
    </div>
  </form>
  <br/>
  <p>This is what the request looks like:</p>
  <span id="solpos_code"></span>
  <div id="solpos"></div>
</div>
<div class="container">
</div>
{% endblock %}

{% block footers %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<!-- <script src="{% static 'highlight/highlight.pack.js' %}"></script> -->
<script>hljs.initHighlightingOnLoad();</script>
<script>
  $(function(){$("input").addClass("form-control");});
  $(function() {
    $("#solposbutton").click( function( event ) {
      event.preventDefault();
      console.log(event);
      console.log(this);
      var items = [];
      var headers = ["date/time"];
      var is_first_row = true;
      var params = $("#solposform").serialize();
      var solpos_url = "/api/v1/pvlib/solarposition/";
      $("#solpos").html("");
      $("#solpos_code").html("");
      $("<pre>", {html: solpos_url + "?" + params}).appendTo("#solpos_code");
      $.getJSON( solpos_url, params, function( data ) {
        $.each( data, function( date, record ) {
          row = "<tr><td><b>" + date + "</b></td>";
          $.each( record, function( col, val ) {
            row += "<td>" + val + "</td>" ;
            if (is_first_row) {
              headers.push( col );
            };
          });
          row += "</tr>"
          is_first_row = false;
          items.push( row );
        });
        items = "<tbody>" + items.join( "" ) + "</tbody>";
        headers = "<th>" + headers.join("</th><th>") + "</th>";
        $( "<table>", {
          "id": "solposTable",
          "class": "table table-striped table-bordered table-condensed",
          html: "<thead>" + headers + "</thead>" + items
        }).appendTo( "#solpos" );
      });
    });
  });
</script>
{% endblock footers %}
